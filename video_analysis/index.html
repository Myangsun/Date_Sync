<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DateSync - Dual Video Analysis</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 20px; }
    .video-row { display: flex; justify-content: center; gap: 40px; margin-bottom: 20px; }
    .video-block { width: 45%; }
    video { width: 100%; border: 1px solid #ccc; margin-bottom: 10px; }
    .dashboard { display: flex; justify-content: space-around; margin-top: 10px; }
    .plot-img { width: 100%; border: 1px solid #ccc; margin-top: 10px; }
    .feedback { text-align: left; padding: 10px; margin-top: 10px; border: 1px solid #ccc; background: #f9f9f9; }
  </style>
</head>
<body>
  <h1>DateSync</h1>
  <p>Dual Video Multimodal Emotion Analysis</p>

  <div class="video-row">
    <div class="video-block">
      <h2>Video 1</h2>
      <video id="video1" controls>
        <source src="video_1.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div class="dashboard">
        <div>Valence: <span id="val1">-</span></div>
        <div>Comfort: <span id="com1">-</span></div>
        <div>Engagement: <span id="eng1">-</span></div>
      </div>
      <div class="feedback">
        <h3>Feedback Video 1</h3>
        <pre id="text1">Loading...</pre>
      </div>
      <img src="output/video_1/metrics_over_time.png" class="plot-img" alt="Plot 1">
    </div>

    <div class="video-block">
      <h2>Video 2</h2>
      <video id="video2" controls>
        <source src="video_2.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      <div class="dashboard">
        <div>Valence: <span id="val2">-</span></div>
        <div>Comfort: <span id="com2">-</span></div>
        <div>Engagement: <span id="eng2">-</span></div>
      </div>
      <div class="feedback">
        <h3>Feedback Video 2</h3>
        <pre id="text2">Loading...</pre>
      </div>
      <img src="output/video_2/metrics_over_time.png" class="plot-img" alt="Plot 2">
    </div>
  </div>

  <script>
    let data1 = [], data2 = [];

    async function loadCSV(url) {
      const res = await fetch(url);
      const text = await res.text();
      const [header, ...lines] = text.trim().split('\n');
      const keys = header.split(',');
      return lines.map(l => {
        const obj = {};
        l.split(',').forEach((v, i) => obj[keys[i]] = parseFloat(v));
        return obj;
      });
    }

    async function loadText(url, elementId) {
      const res = await fetch(url);
      const text = await res.text();
      document.getElementById(elementId).textContent = text;
    }

    async function init() {
      data1 = await loadCSV("output/video_1/metrics_data.csv");
      data2 = await loadCSV("output/video_2/metrics_data.csv");
      loadText("output/video_1/crossmodal_analysis.txt", "text1");
      loadText("output/video_2/crossmodal_analysis.txt", "text2");
    }

    function updateMetrics(videoElement, data, valId, comId, engId) {
      const time = Math.floor(videoElement.currentTime);
      if (data[time]) {
        document.getElementById(valId).textContent = data[time].valence.toFixed(2);
        document.getElementById(comId).textContent = data[time].comfort.toFixed(2);
        document.getElementById(engId).textContent = (data[time].happy + data[time].surprise).toFixed(2);
      }
    }

    init().then(() => {
      const v1 = document.getElementById("video1");
      const v2 = document.getElementById("video2");

      v1.addEventListener("timeupdate", () => updateMetrics(v1, data1, "val1", "com1", "eng1"));
      v2.addEventListener("timeupdate", () => updateMetrics(v2, data2, "val2", "com2", "eng2"));
    });
  </script>
</body>
</html>